---
date: 2025-05-03
categories:
  - FP
---

# 浮点数的计算

浮点数的加法虽然看起来只是“把两个数加起来”，但实际上在计算机里会经过一整套 IEEE 754 浮点运算流程，主要步骤是：

<!-- more -->
---

## 1. 浮点数的表示

以 IEEE 754 \*\*单精度（float, 32 位）\*\*为例：

* **1 位符号位**（sign）：0 表示正，1 表示负
* **8 位指数位**（exponent）：带偏移量的二进制指数，偏移值为 127
* **23 位尾数位**（mantissa/fraction）：隐含一个最高位的 1（除非是非规格化数）

形式：

$$
(-1)^{sign} \times 1.fraction \times 2^{exponent - 127}
$$

---

## 2. 浮点加法的步骤

假设我们要计算 $A + B$：

1. **拆分符号位、指数位、尾数位**
   把两个数都分成 (sign, exponent, mantissa) 的形式。

2. **对阶（Align Exponents）**

   * 比较两个数的指数
   * 将较小指数的尾数右移（相当于除以 2），直到指数相等
   * 移动时要保留额外的位（guard, round, sticky）以便后续舍入

3. **尾数相加/相减（Add/Subtract Mantissas）**

   * 如果符号相同，尾数直接相加
   * 如果符号不同，尾数相减（相当于做减法）

4. **规格化（Normalize Result）**

   * 如果尾数超过了 $1.xxxxx$ 的范围，就右移尾数并增加指数
   * 如果尾数小于 $1.0000...$，就左移尾数并减少指数

5. **舍入（Rounding）**
   IEEE 754 默认使用“向偶数舍入”（Round to Nearest, ties to Even）

6. **检查溢出/下溢**

   * 指数太大：溢出 → 得到 ±∞
   * 指数太小：下溢 → 变成非规格化数或 0

---

### 3. 举个例子

计算 $1.5_{10} + 0.5_{10}$

1. **表示形式**

   * 1.5 → sign=0, exp=127, mantissa=1.1
   * 0.5 → sign=0, exp=126, mantissa=1.0

2. **对阶**

   * 指数差 1 → 0.5 的尾数右移一位：1.0 → 0.1（指数加 1）
   * 两个指数都变成 127

3. **尾数相加**

   * 1.1 + 0.1 = 10.0（二进制）

4. **规格化**

   * 10.0 → 1.0 × 2^1
   * 指数从 127 增加到 128

5. **合成结果**

   * 指数 128 → 真正指数 = 1
   * 最终值 = $2.0$

